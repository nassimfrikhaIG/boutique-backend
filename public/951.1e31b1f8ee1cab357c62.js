(self.webpackChunktest=self.webpackChunktest||[]).push([[951],{7951:(e,t,i)=>{"use strict";i.r(t),i.d(t,{OffreModule:()=>p});var r=i(1116),d=i(9076),o=i(8619),s=i(2797),n=i(1462);function a(e,t){if(1&e&&(o.TgZ(0,"div",42),o._uU(1),o.qZA()),2&e){const e=o.oxw();o.xp6(1),o.Oqu(e.message)}}function l(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"tr"),o.TgZ(1,"td"),o._UZ(2,"img",43),o.qZA(),o.TgZ(3,"td"),o._uU(4),o.qZA(),o.TgZ(5,"td"),o._uU(6),o.qZA(),o.TgZ(7,"td"),o._uU(8),o.qZA(),o.TgZ(9,"td"),o._uU(10),o.ALo(11,"date"),o.qZA(),o.TgZ(12,"td"),o.TgZ(13,"button",44),o.NdJ("click",function(){const t=o.CHM(e).$implicit;return o.oxw().getData(t.discount,t.expiresAt,t._id)}),o._uU(14,"Mise \xe0 jour "),o.qZA(),o.TgZ(15,"button",45),o.NdJ("click",function(){const t=o.CHM(e).$implicit;return o.oxw().deleteOffre(t._id)}),o._uU(16,"Supprimer"),o.qZA(),o.qZA(),o.qZA()}if(2&e){const e=t.$implicit;o.xp6(2),o.Q6J("src",e.productId.image,o.LSH),o.xp6(2),o.Oqu(null==e.productId?null:e.productId.name),o.xp6(2),o.Oqu(null==e.productId.category?null:e.productId.category.name),o.xp6(2),o.hij("",e.discount,"%"),o.xp6(2),o.Oqu(o.xi3(11,5,e.expiresAt,"dd/MM/yyyy HH:mm"))}}function u(e,t){if(1&e&&(o.TgZ(0,"div",46),o._uU(1),o.qZA()),2&e){const e=o.oxw();o.xp6(1),o.Oqu(e.messageSuccess)}}const c=[{path:"",component:(()=>{class e{constructor(e){this.offreService=e,this.offres=[],this.newOffre={productId:"",discount:0,expiresAt:""},this.message="",this.selectedoffre={discount:"",expiresAt:"",id:""},this.messageSuccess="",this.isExpiryDateValid=!1,this.isUpdateExpiryDateValid=!1}ngOnInit(){this.getOffres()}getOffres(){this.offreService.getOffres().subscribe(e=>{console.log("Offres re\xe7ues:",e),this.offres=e},e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des offres",e)})}validateExpiryDate(e){const t=new Date(e.target.value),i=new Date,r=document.getElementById("expirationError");r&&(t<=i?(r.textContent="La date d'expiration doit \xeatre dans le futur.",r.style.display="block",this.isExpiryDateValid=!1):(r.textContent="",r.style.display="none",this.isExpiryDateValid=!0))}validateUpdateExpiryDate(e){const t=new Date(e.target.value),i=new Date,r=document.getElementById("updateExpirationError");r&&(t<=i?(r.textContent="La date d'expiration doit \xeatre dans le futur.",r.style.display="block",this.isUpdateExpiryDateValid=!1):(r.textContent="",r.style.display="none",this.isUpdateExpiryDateValid=!0))}addOffre(){const{productId:e,discount:t,expiresAt:i}=this.newOffre;this.isExpiryDateValid&&this.offreService.addOffre(e,t,i).subscribe(e=>{this.message="Offre ajout\xe9e avec succ\xe8s !",e&&e.offre?this.offres.push(e.offre):this.getOffres(),this.newOffre={productId:"",discount:0,expiresAt:""},this.isExpiryDateValid=!1,this.resetFormValidation()},e=>{this.message="Erreur lors de l'ajout de l'offre.",console.error("Erreur lors de l'ajout de l'offre",e)})}resetFormValidation(){const e=document.getElementById("addOffreForm");if(e){e.reset(),e.querySelectorAll("input").forEach(e=>{e.classList.remove("ng-touched","ng-dirty","ng-invalid"),e.classList.add("ng-pristine","ng-valid","ng-untouched")}),e.querySelectorAll(".invalid-feedback").forEach(e=>{e.style.display="none"});const t=document.getElementById("expirationError");t&&(t.textContent="",t.style.display="none")}}deleteOffre(e){this.offreService.deleteOffre(e).subscribe(t=>{this.message="Offre supprim\xe9e avec succ\xe8s !",this.offres=this.offres.filter(t=>t._id!==e)},e=>{this.message="Erreur lors de la suppression de l'offre.",console.error("Erreur lors de la suppression de l'offre",e)})}getData(e,t,i){this.messageSuccess="";const r=new Date(t).toISOString().slice(0,16);this.selectedoffre={discount:e,expiresAt:r,id:i},setTimeout(()=>{this.validateUpdateExpiryDate({target:{value:r}})},100)}updateProduct(e){this.isUpdateExpiryDateValid&&this.offreService.updateoffre(this.selectedoffre.id,{discount:e.value.discount,expiresAt:e.value.expiresAt}).subscribe(t=>{this.messageSuccess="L'offre a \xe9t\xe9 mise \xe0 jour avec succ\xe8s.";const i=this.offres.findIndex(e=>e._id===this.selectedoffre.id);-1!==i?(this.offres[i].discount=e.value.discount,this.offres[i].expiresAt=new Date(e.value.expiresAt)):this.getOffres(),setTimeout(()=>{this.resetUpdateFormValidation(e)},1500)},e=>{this.messageSuccess="Erreur lors de la mise \xe0 jour de l'offre",console.error("Erreur lors de la mise \xe0 jour de l'offre",e)})}resetUpdateFormValidation(e){e&&(e.form.markAsPristine(),e.form.markAsUntouched(),document.querySelectorAll("#exampleModal .invalid-feedback").forEach(e=>{e.style.display="none"}),setTimeout(()=>{this.messageSuccess=""},2e3))}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(s.s))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-offre"]],decls:88,vars:20,consts:[[1,"container-fluid"],[1,"h3","mb-4","text-gray-800"],[1,"card","shadow","mb-4"],[1,"card-body"],["id","addOffreForm","novalidate","",3,"submit"],["addForm","ngForm"],[1,"form-group"],["for","productId"],["type","text","placeholder","Entrez l'ID du produit","name","productId","required","",1,"form-control",3,"ngModel","ngModelChange"],["productIdInput","ngModel"],[1,"invalid-feedback"],["for","discount"],["type","number","placeholder","Entrez la r\xe9duction en %","name","discount","required","","min","1","max","100",1,"form-control",3,"ngModel","ngModelChange"],["discountInput","ngModel"],["for","expiresAt"],["type","datetime-local","name","expiresAt","required","",1,"form-control",3,"ngModel","ngModelChange","change"],["expiresAtInput","ngModel"],["id","expirationError",1,"invalid-feedback"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"card-header","py-3"],[1,"m-0","font-weight-bold","text-primary"],["class","alert alert-info","role","alert",4,"ngIf"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],["novalidate","",3,"ngSubmit"],["f","ngForm"],["type","number","name","discount","required","","min","1","max","100",1,"form-control",3,"ngModel","ngModelChange"],["updateDiscountInput","ngModel"],["updateExpiresAtInput","ngModel"],["id","updateExpirationError",1,"invalid-feedback"],["class","alert alert-success",4,"ngIf"],[1,"btn","btn-primary",3,"disabled"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["role","alert",1,"alert","alert-info"],["alt","Product Image ","width","50",3,"src"],["data-toggle","modal","data-target","#exampleModal",1,"btn","btn-success",3,"click"],[1,"btn","btn-danger",3,"click"],[1,"alert","alert-success"]],template:function(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"div",0),o.TgZ(1,"h1",1),o._uU(2,"Ajouter une Offre"),o.qZA(),o.TgZ(3,"div",2),o.TgZ(4,"div",3),o.TgZ(5,"form",4,5),o.NdJ("submit",function(e){return t.addOffre(),e.preventDefault()}),o.TgZ(7,"div",6),o.TgZ(8,"label",7),o._uU(9,"ID du produit"),o.qZA(),o.TgZ(10,"input",8,9),o.NdJ("ngModelChange",function(e){return t.newOffre.productId=e}),o.qZA(),o.TgZ(12,"div",10),o._uU(13," ID du produit est requis "),o.qZA(),o.qZA(),o.TgZ(14,"div",6),o.TgZ(15,"label",11),o._uU(16,"R\xe9duction (%)"),o.qZA(),o.TgZ(17,"input",12,13),o.NdJ("ngModelChange",function(e){return t.newOffre.discount=e}),o.qZA(),o.TgZ(19,"div",10),o._uU(20," La r\xe9duction est requise et doit \xeatre entre 1 et 100% "),o.qZA(),o.qZA(),o.TgZ(21,"div",6),o.TgZ(22,"label",14),o._uU(23,"Date d'expiration"),o.qZA(),o.TgZ(24,"input",15,16),o.NdJ("ngModelChange",function(e){return t.newOffre.expiresAt=e})("change",function(e){return t.validateExpiryDate(e)}),o.qZA(),o.TgZ(26,"div",10),o._uU(27," Date d'expiration est requise "),o.qZA(),o._UZ(28,"div",17),o.qZA(),o.TgZ(29,"button",18),o._uU(30," Ajouter une Offre "),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(31,"div",0),o.TgZ(32,"div",2),o.TgZ(33,"div",19),o.TgZ(34,"h6",20),o._uU(35,"Offres Actuelles"),o.qZA(),o.qZA(),o.TgZ(36,"div",3),o.YNc(37,a,2,1,"div",21),o.TgZ(38,"table",22),o.TgZ(39,"thead"),o.TgZ(40,"tr"),o.TgZ(41,"th"),o._uU(42,"Image"),o.qZA(),o.TgZ(43,"th"),o._uU(44,"Nom du Produit"),o.qZA(),o.TgZ(45,"th"),o._uU(46,"Categorie"),o.qZA(),o.TgZ(47,"th"),o._uU(48,"R\xe9duction (%)"),o.qZA(),o.TgZ(49,"th"),o._uU(50,"Date d'expiration"),o.qZA(),o.TgZ(51,"th"),o._uU(52,"Actions"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(53,"tbody"),o.YNc(54,l,17,8,"tr",23),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(55,"div",24),o.TgZ(56,"div",25),o.TgZ(57,"div",26),o.TgZ(58,"div",27),o.TgZ(59,"h5",28),o._uU(60,"Mettre \xe0 jour l'Offre"),o.qZA(),o.TgZ(61,"button",29),o.TgZ(62,"span",30),o._uU(63,"\xd7"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(64,"div",31),o.TgZ(65,"form",32,33),o.NdJ("ngSubmit",function(){o.CHM(e);const i=o.MAs(66);return t.updateProduct(i)}),o.TgZ(67,"div",6),o.TgZ(68,"label",11),o._uU(69,"R\xe9duction (%)"),o.qZA(),o.TgZ(70,"input",34,35),o.NdJ("ngModelChange",function(e){return t.selectedoffre.discount=e}),o.qZA(),o.TgZ(72,"div",10),o._uU(73," La r\xe9duction est requise et doit \xeatre entre 1 et 100% "),o.qZA(),o.qZA(),o.TgZ(74,"div",6),o.TgZ(75,"label",14),o._uU(76,"Date d'expiration"),o.qZA(),o.TgZ(77,"input",15,36),o.NdJ("ngModelChange",function(e){return t.selectedoffre.expiresAt=e})("change",function(e){return t.validateUpdateExpiryDate(e)}),o.qZA(),o.TgZ(79,"div",10),o._uU(80," Date d'expiration est requise "),o.qZA(),o._UZ(81,"div",37),o.qZA(),o.YNc(82,u,2,1,"div",38),o.TgZ(83,"button",39),o._uU(84,"Mettre \xe0 jour l'Offre"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(85,"div",40),o.TgZ(86,"button",41),o._uU(87,"Fermer"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&e){const e=o.MAs(11),i=o.MAs(18),r=o.MAs(25),d=o.MAs(66),s=o.MAs(71),n=o.MAs(78);o.xp6(10),o.Q6J("ngModel",t.newOffre.productId),o.xp6(2),o.Udp("display",e.invalid&&e.touched?"block":"none"),o.xp6(5),o.Q6J("ngModel",t.newOffre.discount),o.xp6(2),o.Udp("display",i.invalid&&i.touched?"block":"none"),o.xp6(5),o.Q6J("ngModel",t.newOffre.expiresAt),o.xp6(2),o.Udp("display",r.invalid&&r.touched?"block":"none"),o.xp6(3),o.Q6J("disabled",e.invalid||i.invalid||r.invalid||!t.isExpiryDateValid),o.xp6(8),o.Q6J("ngIf",t.message),o.xp6(17),o.Q6J("ngForOf",t.offres),o.xp6(16),o.Q6J("ngModel",t.selectedoffre.discount),o.xp6(2),o.Udp("display",s.invalid&&s.touched?"block":"none"),o.xp6(5),o.Q6J("ngModel",t.selectedoffre.expiresAt),o.xp6(2),o.Udp("display",n.invalid&&n.touched?"block":"none"),o.xp6(3),o.Q6J("ngIf",t.messageSuccess),o.xp6(1),o.Q6J("disabled",d.invalid||!t.isUpdateExpiryDateValid)}},directives:[n._Y,n.JL,n.F,n.Fj,n.Q7,n.JJ,n.On,n.qQ,n.Fd,n.wV,r.O5,r.sg],pipes:[r.uU],styles:[""]}),e})()}];let f=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[d.Bz.forChild(c)],d.Bz]}),e})(),p=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[r.ez,f,n.u5]]}),e})()}}]);