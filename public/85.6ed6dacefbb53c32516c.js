(self.webpackChunktest=self.webpackChunktest||[]).push([[85],{4085:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ChekoutModule:()=>f});var r=i(1116),o=i(3146),a=i(1462),n=i(5614),l=i(5482),u=i(5829),c=i(2225);function s(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," Le pr\xe9nom est requis "),n.qZA())}function d(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," Le nom est requis "),n.qZA())}function g(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," Un email valide est requis "),n.qZA())}function Z(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," Le num\xe9ro de t\xe9l\xe9phone est requis "),n.qZA())}function p(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," L'adresse est requise "),n.qZA())}function m(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," Le pays est requis "),n.qZA())}function h(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," La ville est requise "),n.qZA())}function v(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," La r\xe9gion est requise "),n.qZA())}function q(e,t){1&e&&(n.TgZ(0,"div",62),n._uU(1," Le code postal est requis "),n.qZA())}const A=function(e){return["/product",e]};function T(e,t){if(1&e){const e=n.EpF();n.TgZ(0,"div",63),n.TgZ(1,"div",64),n.TgZ(2,"div",65),n._UZ(3,"img",66),n.qZA(),n.TgZ(4,"div",67),n.TgZ(5,"span",68),n.TgZ(6,"a",69),n._uU(7),n.qZA(),n.qZA(),n.TgZ(8,"span",70),n._uU(9),n.qZA(),n.TgZ(10,"span",71),n._uU(11),n.qZA(),n.qZA(),n.qZA(),n.TgZ(12,"a",72),n.NdJ("click",function(){const t=n.CHM(e).$implicit;return n.oxw().removeItem(t.product._id)}),n.qZA(),n.qZA()}if(2&e){const e=t.$implicit;n.xp6(3),n.s9C("alt",e.product.name),n.Q6J("src",e.product.image,n.LSH),n.xp6(3),n.Q6J("routerLink",n.VKq(6,A,e.product._id)),n.xp6(1),n.Oqu(e.product.name),n.xp6(2),n.hij("Quantit\xe9 x ",e.quantity,""),n.xp6(2),n.hij("",e.price||e.product.price,"DT")}}const y=[{path:"",component:(()=>{class e{constructor(e,t,i,r,o){this.cartService=e,this.commandeService=t,this.formBuilder=i,this.router=r,this.authService=o,this.cart=null,this.totalPrice=0,this.paymentMethod="cash-on-delivery",this.currentUser=null,this.isLoading=!1,this.loadingError="",this.cartSubscription=null,this.checkoutForm=this.formBuilder.group({firstName:["",a.kI.required],lastName:["",a.kI.required],email:["",[a.kI.required,a.kI.email]],phone:["",a.kI.required],streetAddress:["",a.kI.required],apartmentAddress:[""],country:["",a.kI.required],city:["",a.kI.required],state:["",a.kI.required],zipCode:["",a.kI.required],password:[""],orderNote:[""]})}ngOnInit(){this.cartSubscription=this.cartService.cartState$.subscribe(e=>{e?(this.cart=e,this.calculateTotal()):this.loadCart()},e=>{console.error("Erreur lors de la souscription au panier:",e)}),this.loadUserData()}ngOnDestroy(){this.cartSubscription&&this.cartSubscription.unsubscribe()}loadCart(){this.cartService.getCart().subscribe(e=>{this.cart=e,this.calculateTotal()},e=>{console.error("Erreur lors du chargement du panier:",e)})}loadUserData(){if(this.authService.userLoggedIn()){this.isLoading=!0;const e=this.authService.getUserId();e?(console.log("UserId r\xe9cup\xe9r\xe9:",e),this.authService.getUserById(e).subscribe(e=>{console.log("Donn\xe9es utilisateur r\xe9cup\xe9r\xe9es:",e),this.currentUser=e,this.fillUserData(),this.isLoading=!1},e=>{console.error("Erreur lors du chargement des donn\xe9es utilisateur:",e),this.loadingError=`Erreur: ${e.status||"inconnue"} - ${e.message||"Impossible de charger les donn\xe9es utilisateur"}`,this.isLoading=!1})):(console.error("Impossible de r\xe9cup\xe9rer l'ID utilisateur du token"),console.log("Token d\xe9cod\xe9:",this.authService.getDecodedToken()),this.isLoading=!1)}}fillUserData(){this.currentUser&&(console.log("Remplissage du formulaire avec les donn\xe9es utilisateur"),this.checkoutForm.patchValue({firstName:this.currentUser.firstName||"",lastName:this.currentUser.lastName||"",email:this.currentUser.email||"",phone:this.currentUser.phone||"",streetAddress:this.currentUser.address||"",country:this.currentUser.country||"",city:this.currentUser.city||"",state:this.currentUser.region||"",zipCode:this.currentUser.postalCode||""}))}calculateTotal(){this.totalPrice=this.cart&&this.cart.items?this.cart.items.reduce((e,t)=>e+t.quantity*(t.price||t.product&&t.product.price||0),0):0}setPaymentMethod(e){switch(this.paymentMethod=e,e){case"cash-on-delivery":this.paymentMethod="cash";break;case"direct-bank-transfer":this.paymentMethod="direct-bank-transfer";break;case"pay-with-card":this.paymentMethod="pay-with-card";break;case"pay-pal":this.paymentMethod="paypal";break;default:this.paymentMethod="cash"}}submitCheckout(){var e,t,i,r,o,a,n,l,u,c;if(this.checkoutForm.valid){const s={firstName:null===(e=this.checkoutForm.get("firstName"))||void 0===e?void 0:e.value,lastName:null===(t=this.checkoutForm.get("lastName"))||void 0===t?void 0:t.value,email:null===(i=this.checkoutForm.get("email"))||void 0===i?void 0:i.value,phone:null===(r=this.checkoutForm.get("phone"))||void 0===r?void 0:r.value,address:null===(o=this.checkoutForm.get("streetAddress"))||void 0===o?void 0:o.value,city:null===(a=this.checkoutForm.get("city"))||void 0===a?void 0:a.value,state:null===(n=this.checkoutForm.get("state"))||void 0===n?void 0:n.value,zipCode:null===(l=this.checkoutForm.get("zipCode"))||void 0===l?void 0:l.value,country:null===(u=this.checkoutForm.get("country"))||void 0===u?void 0:u.value,orderNote:null===(c=this.checkoutForm.get("orderNote"))||void 0===c?void 0:c.value};this.commandeService.checkout(s,this.paymentMethod).subscribe(e=>{this.cartService.clearCart().subscribe(()=>{this.router.navigate(["/confirmation-command",e.order._id])})},e=>{console.error("Checkout error:",e)})}else Object.keys(this.checkoutForm.controls).forEach(e=>{var t;null===(t=this.checkoutForm.get(e))||void 0===t||t.markAsTouched()})}removeItem(e){this.cartService.removeFromCart(e).subscribe(()=>{})}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(l.r),n.Y36(u.I),n.Y36(a.qu),n.Y36(o.F0),n.Y36(c.A))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-checkout"]],decls:140,vars:17,consts:[["id","app"],[1,"app-content"],[1,"u-s-p-y-60"],[1,"section__content"],[1,"container"],[1,"breadcrumb"],[1,"breadcrumb__wrap"],[1,"breadcrumb__list"],[1,"has-separator"],["routerLink","/accueil"],[1,"is-marked"],["routerLink","/checkout"],[1,"u-s-p-b-60"],[1,"checkout-f"],[1,"row"],[1,"col-lg-6"],[1,"checkout-f__h1"],[1,"checkout-f__delivery",3,"formGroup","ngSubmit"],[1,"u-s-m-b-30"],[1,"gl-inline"],[1,"u-s-m-b-15"],["for","billing-fname",1,"gl-label"],["type","text","id","billing-fname","formControlName","firstName",1,"input-text","input-text--primary-style"],["class","u-s-m-b-15 text-danger",4,"ngIf"],["for","billing-lname",1,"gl-label"],["type","text","id","billing-lname","formControlName","lastName",1,"input-text","input-text--primary-style"],["for","billing-email",1,"gl-label"],["type","email","id","billing-email","formControlName","email",1,"input-text","input-text--primary-style"],["for","billing-phone",1,"gl-label"],["type","text","id","billing-phone","formControlName","phone",1,"input-text","input-text--primary-style"],["for","billing-street",1,"gl-label"],["type","text","id","billing-street","placeholder","Nom de rue et num\xe9ro","formControlName","streetAddress",1,"input-text","input-text--primary-style"],["for","billing-country",1,"gl-label"],["type","text","id","billing-country","formControlName","country","placeholder","Entrez votre pays",1,"input-text","input-text--primary-style"],["for","billing-town-city",1,"gl-label"],["type","text","id","billing-town-city","formControlName","city","placeholder","Entrez votre ville",1,"input-text","input-text--primary-style"],["for","billing-state",1,"gl-label"],["type","text","id","billing-state","formControlName","state","placeholder","Entrez votre r\xe9gion",1,"input-text","input-text--primary-style"],["for","billing-zip",1,"gl-label"],["type","text","id","billing-zip","placeholder","Code postal","formControlName","zipCode",1,"input-text","input-text--primary-style"],[1,"u-s-m-b-10"],["for","order-note",1,"gl-label"],["id","order-note","formControlName","orderNote",1,"text-area","text-area--primary-style"],[1,"o-summary"],[1,"o-summary__section","u-s-m-b-30"],[1,"o-summary__item-wrap","gl-scroll"],["class","o-card",4,"ngFor","ngForOf"],[1,"o-summary__box"],[1,"o-summary__table"],[1,"checkout-f__payment"],[1,"radio-box"],["type","radio","id","cash-on-delivery","name","payment",3,"checked","change"],[1,"radio-box__state","radio-box__state--primary"],["for","cash-on-delivery",1,"radio-box__label"],[1,"gl-text","u-s-m-t-6"],["type","radio","id","direct-bank-transfer","name","payment",3,"checked","change"],["for","direct-bank-transfer",1,"radio-box__label"],["type","radio","id","pay-with-card","name","payment",3,"checked","change"],["for","pay-with-card",1,"radio-box__label"],["type","radio","id","pay-pal","name","payment",3,"checked","change"],["for","pay-pal",1,"radio-box__label"],["type","button",1,"btn","btn--e-brand-b-2",3,"click"],[1,"u-s-m-b-15","text-danger"],[1,"o-card"],[1,"o-card__flex"],[1,"o-card__img-wrap"],[1,"u-img-fluid",3,"src","alt"],[1,"o-card__info-wrap"],[1,"o-card__name"],[3,"routerLink"],[1,"o-card__quantity"],[1,"o-card__price"],[1,"o-card__del","far","fa-trash-alt",3,"click"]],template:function(e,t){if(1&e&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n.TgZ(4,"div",4),n.TgZ(5,"div",5),n.TgZ(6,"div",6),n.TgZ(7,"ul",7),n.TgZ(8,"li",8),n.TgZ(9,"a",9),n._uU(10,"Accueil"),n.qZA(),n.qZA(),n.TgZ(11,"li",10),n.TgZ(12,"a",11),n._uU(13,"Paiement"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(14,"div",12),n.TgZ(15,"div",3),n.TgZ(16,"div",4),n.TgZ(17,"div",13),n.TgZ(18,"div",14),n.TgZ(19,"div",15),n.TgZ(20,"h1",16),n._uU(21,"INFORMATIONS DE LIVRAISON"),n.qZA(),n.TgZ(22,"form",17),n.NdJ("ngSubmit",function(){return t.submitCheckout()}),n.TgZ(23,"div",18),n.TgZ(24,"div",19),n.TgZ(25,"div",20),n.TgZ(26,"label",21),n._uU(27,"PR\xc9NOM *"),n.qZA(),n._UZ(28,"input",22),n.YNc(29,s,2,0,"div",23),n.qZA(),n.TgZ(30,"div",20),n.TgZ(31,"label",24),n._uU(32,"NOM *"),n.qZA(),n._UZ(33,"input",25),n.YNc(34,d,2,0,"div",23),n.qZA(),n.qZA(),n.TgZ(35,"div",20),n.TgZ(36,"label",26),n._uU(37,"E-MAIL *"),n.qZA(),n._UZ(38,"input",27),n.YNc(39,g,2,0,"div",23),n.qZA(),n.TgZ(40,"div",20),n.TgZ(41,"label",28),n._uU(42,"T\xc9L\xc9PHONE *"),n.qZA(),n._UZ(43,"input",29),n.YNc(44,Z,2,0,"div",23),n.qZA(),n.TgZ(45,"div",20),n.TgZ(46,"label",30),n._uU(47,"ADRESSE *"),n.qZA(),n._UZ(48,"input",31),n.YNc(49,p,2,0,"div",23),n.qZA(),n.TgZ(50,"div",20),n.TgZ(51,"label",32),n._uU(52,"PAYS *"),n.qZA(),n._UZ(53,"input",33),n.YNc(54,m,2,0,"div",23),n.qZA(),n.TgZ(55,"div",20),n.TgZ(56,"label",34),n._uU(57,"VILLE *"),n.qZA(),n._UZ(58,"input",35),n.YNc(59,h,2,0,"div",23),n.qZA(),n.TgZ(60,"div",20),n.TgZ(61,"label",36),n._uU(62,"R\xc9GION *"),n.qZA(),n._UZ(63,"input",37),n.YNc(64,v,2,0,"div",23),n.qZA(),n.TgZ(65,"div",20),n.TgZ(66,"label",38),n._uU(67,"CODE POSTAL *"),n.qZA(),n._UZ(68,"input",39),n.YNc(69,q,2,0,"div",23),n.qZA(),n.TgZ(70,"div",40),n.TgZ(71,"label",41),n._uU(72,"NOTE DE COMMANDE"),n.qZA(),n._UZ(73,"textarea",42),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(74,"div",15),n.TgZ(75,"h1",16),n._uU(76,"R\xc9SUM\xc9 DE LA COMMANDE"),n.qZA(),n.TgZ(77,"div",43),n.TgZ(78,"div",44),n.TgZ(79,"div",45),n.YNc(80,T,13,8,"div",46),n.qZA(),n.qZA(),n.TgZ(81,"div",44),n.TgZ(82,"div",47),n.TgZ(83,"table",48),n.TgZ(84,"tbody"),n.TgZ(85,"tr"),n.TgZ(86,"td"),n._uU(87,"Sous-total"),n.qZA(),n.TgZ(88,"td"),n._uU(89),n.qZA(),n.qZA(),n.TgZ(90,"tr"),n.TgZ(91,"td"),n._uU(92,"Livraison"),n.qZA(),n.TgZ(93,"td"),n._uU(94,"Gratuit"),n.qZA(),n.qZA(),n.TgZ(95,"tr"),n.TgZ(96,"td"),n._uU(97,"TOTAL TTC"),n.qZA(),n.TgZ(98,"td"),n._uU(99),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(100,"div",44),n.TgZ(101,"div",47),n.TgZ(102,"h1",16),n._uU(103,"INFORMATIONS DE PAIEMENT"),n.qZA(),n.TgZ(104,"form",49),n.TgZ(105,"div",40),n.TgZ(106,"div",50),n.TgZ(107,"input",51),n.NdJ("change",function(){return t.setPaymentMethod("cash-on-delivery")}),n.qZA(),n.TgZ(108,"div",52),n.TgZ(109,"label",53),n._uU(110,"Paiement \xe0 la livraison"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(111,"span",54),n._uU(112,"Payez lors de la livraison. (Ce service n'est disponible que dans certains pays)"),n.qZA(),n.qZA(),n.TgZ(113,"div",40),n.TgZ(114,"div",50),n.TgZ(115,"input",55),n.NdJ("change",function(){return t.setPaymentMethod("direct-bank-transfer")}),n.qZA(),n.TgZ(116,"div",52),n.TgZ(117,"label",56),n._uU(118,"Virement bancaire direct"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(119,"span",54),n._uU(120,"Effectuez votre paiement directement sur notre compte bancaire. Veuillez utiliser votre num\xe9ro de commande comme r\xe9f\xe9rence. Votre commande ne sera exp\xe9di\xe9e qu'une fois les fonds cr\xe9dit\xe9s sur notre compte."),n.qZA(),n.qZA(),n.TgZ(121,"div",40),n.TgZ(122,"div",50),n.TgZ(123,"input",57),n.NdJ("change",function(){return t.setPaymentMethod("pay-with-card")}),n.qZA(),n.TgZ(124,"div",52),n.TgZ(125,"label",58),n._uU(126,"Payer par carte de cr\xe9dit / d\xe9bit"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(127,"span",54),n._uU(128,"Les cartes de cr\xe9dit internationales doivent \xeatre \xe9ligibles pour une utilisation en Tunisie."),n.qZA(),n.qZA(),n.TgZ(129,"div",40),n.TgZ(130,"div",50),n.TgZ(131,"input",59),n.NdJ("change",function(){return t.setPaymentMethod("pay-pal")}),n.qZA(),n.TgZ(132,"div",52),n.TgZ(133,"label",60),n._uU(134,"PayPal"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(135,"span",54),n._uU(136,'Lorsque vous cliquez sur "Passer la commande" ci-dessous, nous vous redirigerons vers le site PayPal pour configurer vos informations de facturation.'),n.qZA(),n.qZA(),n.TgZ(137,"div",20),n.TgZ(138,"button",61),n.NdJ("click",function(){return t.submitCheckout()}),n._uU(139,"PASSER LA COMMANDE"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&e){let e,i,r,o,a,l,u,c,s;n.xp6(22),n.Q6J("formGroup",t.checkoutForm),n.xp6(7),n.Q6J("ngIf",(null==(e=t.checkoutForm.get("firstName"))?null:e.invalid)&&(null==(e=t.checkoutForm.get("firstName"))?null:e.touched)),n.xp6(5),n.Q6J("ngIf",(null==(i=t.checkoutForm.get("lastName"))?null:i.invalid)&&(null==(i=t.checkoutForm.get("lastName"))?null:i.touched)),n.xp6(5),n.Q6J("ngIf",(null==(r=t.checkoutForm.get("email"))?null:r.invalid)&&(null==(r=t.checkoutForm.get("email"))?null:r.touched)),n.xp6(5),n.Q6J("ngIf",(null==(o=t.checkoutForm.get("phone"))?null:o.invalid)&&(null==(o=t.checkoutForm.get("phone"))?null:o.touched)),n.xp6(5),n.Q6J("ngIf",(null==(a=t.checkoutForm.get("streetAddress"))?null:a.invalid)&&(null==(a=t.checkoutForm.get("streetAddress"))?null:a.touched)),n.xp6(5),n.Q6J("ngIf",(null==(l=t.checkoutForm.get("country"))?null:l.invalid)&&(null==(l=t.checkoutForm.get("country"))?null:l.touched)),n.xp6(5),n.Q6J("ngIf",(null==(u=t.checkoutForm.get("city"))?null:u.invalid)&&(null==(u=t.checkoutForm.get("city"))?null:u.touched)),n.xp6(5),n.Q6J("ngIf",(null==(c=t.checkoutForm.get("state"))?null:c.invalid)&&(null==(c=t.checkoutForm.get("state"))?null:c.touched)),n.xp6(5),n.Q6J("ngIf",(null==(s=t.checkoutForm.get("zipCode"))?null:s.invalid)&&(null==(s=t.checkoutForm.get("zipCode"))?null:s.touched)),n.xp6(11),n.Q6J("ngForOf",null==t.cart?null:t.cart.items),n.xp6(9),n.hij("",t.totalPrice," DT"),n.xp6(10),n.hij("",t.totalPrice," DT"),n.xp6(8),n.Q6J("checked","cash-on-delivery"===t.paymentMethod),n.xp6(8),n.Q6J("checked","direct-bank-transfer"===t.paymentMethod),n.xp6(8),n.Q6J("checked","pay-with-card"===t.paymentMethod),n.xp6(8),n.Q6J("checked","pay-pal"===t.paymentMethod)}},directives:[o.yS,a._Y,a.JL,a.sg,a.Fj,a.JJ,a.u,r.O5,r.sg,a.F],styles:[""]}),e})()}];let b=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[o.Bz.forChild(y)],o.Bz]}),e})(),f=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[r.ez,b,a.UX,a.u5]]}),e})()}}]);